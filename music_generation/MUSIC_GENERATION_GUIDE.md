# üéµ Music Generation and Playback Guide

## Overview

Your HMM model can **predict the next chord**. I've created two scripts to help you convert the chord sequences generated by the model into playable music.

## üöÄ Quick Start

### 1. Install Dependencies

```bash
pip install MIDIUtil
```

Or reinstall all dependencies:
```bash
pip install -r requirements.txt
```

### 2. Generate Simple Chord Progression (Basic)

```bash
python music_generation/generate_music.py \
    --model models/hmm_conditional.pkl \
    --mode major \
    --length 32 \
    --output generated_music/my_chords.mid
```

**Parameter Descriptions:**
- `--model`: Path to trained model
- `--mode`: Key mode (`major` or `minor`)
- `--length`: Number of chords to generate
- `--output`: Output MIDI filename
- `--key`: Key (60=C, 62=D, 64=E, 65=F, 67=G, 69=A, 71=B)
- `--tempo`: Speed (BPM, default 120)
- `--seed`: Random seed (optional, for reproducing same sequence)

### 3. Generate Complete Music (with Melody and Bass) ‚≠ê Recommended

```bash
python music_generation/generate_full_music.py \
    --model models/hmm_conditional.pkl \
    --mode major \
    --bars 8 \
    --output generated_music/my_song.mid
```

**Parameter Descriptions:**
- `--bars`: Number of bars (1 bar = 4 beats = 2 chords)
- `--melody` / `--no-melody`: Whether to add melody track
- `--bass` / `--no-bass`: Whether to add bass track
- Other parameters same as basic version

**Examples:**
```bash
# Generate 8-bar C major music with melody and bass
python music_generation/generate_full_music.py \
    --model models/hmm_conditional.pkl \
    --mode major \
    --bars 8 \
    --key 60 \
    --tempo 100 \
    --output generated_music/happy_song.mid

# Generate 16-bar D minor music
python music_generation/generate_full_music.py \
    --model models/hmm_conditional.pkl \
    --mode minor \
    --bars 16 \
    --key 62 \
    --tempo 85 \
    --output generated_music/sad_song.mid
```

## üéß How to Play Generated MIDI Files

### Method 1: GarageBand (macOS) ‚≠ê Most Recommended

1. Open GarageBand
2. Create new project or directly drag MIDI file into GarageBand
3. Double-click the generated `.mid` file
4. You can:
   - Change instrument sounds
   - Adjust track volumes
   - Add effects
   - Export as MP3/AAC audio formats

### Method 2: QuickTime Player (macOS)

```bash
open generated_music/my_song.mid
```
Or: Right-click file ‚Üí Open With ‚Üí QuickTime Player

### Method 3: Online MIDI Players

Upload to online players:
- https://onlinesequencer.net/import
- https://www.onlinepianist.com/virtual-piano
- https://signal.vercel.app/edit (visual editor)

### Method 4: Python Playback (requires additional library)

```bash
# Install pygame
pip install pygame

# Play using pygame
python -c "import pygame; pygame.mixer.init(); pygame.mixer.music.load('generated_music/my_song.mid'); pygame.mixer.music.play(); import time; time.sleep(30)"
```

### Method 5: Convert to MP3

Using `timidity` or `fluidsynth`:

```bash
# Install (macOS)
brew install timidity

# Convert to WAV
timidity generated_music/my_song.mid -Ow -o my_song.wav

# Convert to MP3 (requires ffmpeg)
brew install ffmpeg
ffmpeg -i my_song.wav -acodec mp3 my_song.mp3
```

## üìä Key Reference

### Key (Tonality) MIDI Numbers

| Note | MIDI # | Major Example | Minor Example |
|------|--------|---------------|---------------|
| C    | 60     | C major       | C minor       |
| D    | 62     | D major       | D minor       |
| E    | 64     | E major       | E minor       |
| F    | 65     | F major       | F minor       |
| G    | 67     | G major       | G minor       |
| A    | 69     | A major       | A minor       |
| B    | 71     | B major       | B minor       |

### Common Tempo (Speed)

- **Slow**: 60-80 BPM (ballad, sad)
- **Medium**: 90-120 BPM (pop, general)
- **Fast**: 130-160 BPM (happy, dance)

## üéº Generation Examples

### Example 1: Pop Song Style
```bash
python music_generation/generate_full_music.py \
    --model models/hmm_conditional.pkl \
    --mode major \
    --bars 16 \
    --key 60 \
    --tempo 120 \
    --output generated_music/pop_song.mid \
    --seed 42
```

### Example 2: Ballad Style
```bash
python music_generation/generate_full_music.py \
    --model models/hmm_conditional.pkl \
    --mode minor \
    --bars 12 \
    --key 69 \
    --tempo 72 \
    --output generated_music/ballad.mid \
    --seed 123
```

### Example 3: Chords Only (no melody)
```bash
python music_generation/generate_full_music.py \
    --model models/hmm_conditional.pkl \
    --mode major \
    --bars 8 \
    --no-melody \
    --no-bass \
    --output generated_music/chords_only.mid
```

## üîß Advanced: View Original Data MIDI

If you want to play MIDI files from the original POP909 dataset:

```bash
# View MIDI files of a song
ls data/POP909/001/

# Open with GarageBand
open data/POP909/001/*.mid

# Batch playback
for file in data/POP909/001/*.mid; do
    echo "Playing: $file"
    open "$file"
    sleep 5
done
```

## üéØ Workflow Summary

```
Train Model ‚Üí Generate Chord Sequence ‚Üí Convert to MIDI ‚Üí Play/Edit
   ‚Üì              ‚Üì                         ‚Üì              ‚Üì
You're Done    New Script Done          New Script Done  GarageBand
```

## üí° Tips

1. **Seed**: Using the same seed generates the same music
2. **Mode**: Major keys sound happier, minor keys more melancholic
3. **Bars**: Pop song sections are typically 4/8/16 bars
4. **GarageBand Advantages**: Can change instruments, add drums, export audio

## üêõ Common Issues

**Q: Generated music sounds random?**
- A: This is normal, as the model only learned chord transition probabilities. You can try:
  - Adjust seed to find better sequences
  - Use conditional model (more music theory compliant)
  - Generate more sequences, pick the best

**Q: Don't have GarageBand installed?**
- A: Use online MIDI players or QuickTime Player

**Q: Want more complex melodies?**
- A: You can modify the `generate_melody()` function in `generate_full_music.py`

**Q: How to batch generate multiple songs?**
```bash
for i in {1..10}; do
    python music_generation/generate_full_music.py \
        --model models/hmm_conditional.pkl \
        --mode major \
        --bars 8 \
        --output generated_music/song_$i.mid \
        --seed $i
done
```
