# HMM æ¨¡å‹è®­ç»ƒä¸å¯¹æ¯”æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®åŒ…å«ä¸¤ä¸ªå’Œå¼¦åºåˆ—å»ºæ¨¡æ–¹æ³•ï¼š
- **Baseline HMM**: åŸºäºè½¬è°ƒçš„æ ‡å‡†HMM
- **Conditional HMM**: åŸºäºåŠŸèƒ½å’Œå¼¦çš„è°ƒå¼æ¡ä»¶HMM

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è®­ç»ƒæ¨¡å‹

#### è®­ç»ƒ Baseline HMM
```bash
python scripts/train_baseline.py \
    --pop909 data/POP909 \
    --out models/hmm_baseline.pkl \
    --seed 42
```

#### è®­ç»ƒ Conditional HMM
```bash
python scripts/train_conditional.py \
    --pop909 data/POP909 \
    --out models/hmm_conditional.pkl \
    --seed 42
```

**é‡è¦**: ä¸¤ä¸ªæ¨¡å‹å¿…é¡»ä½¿ç”¨**ç›¸åŒçš„seed**ä»¥ç¡®ä¿æ•°æ®åˆ’åˆ†ä¸€è‡´ï¼

### 2. å¯¹æ¯”æ¨¡å‹

```bash
python scripts/compare_models.py \
    --baseline models/hmm_baseline.pkl \
    --conditional models/hmm_conditional.pkl
```

### 3. æµ‹è¯•æ¨¡å‹

#### æµ‹è¯• Baseline HMM
```bash
python scripts/test_baseline.py \
    --model models/hmm_baseline.pkl \
    --pop909 data/POP909
```

#### æµ‹è¯• Conditional HMM
```bash
python scripts/test_conditional.py \
    --model models/hmm_conditional.pkl \
    --pop909 data/POP909
```

## ğŸ“Š æœ€æ–°ç»“æœ (2025-12-03)

ä½¿ç”¨ç›¸åŒçš„éšæœºåˆ’åˆ† (seed=42):

| æŒ‡æ ‡ | Baseline HMM | Conditional HMM | æ”¹è¿› |
|------|--------------|-----------------|------|
| **è¯æ±‡é‡** | 193 | 20 | **â†“89.6%** |
| **è®­ç»ƒå›°æƒ‘åº¦** | 11.61 | 5.04 | **â†“56.6%** |
| **éªŒè¯å›°æƒ‘åº¦** | 12.20 | 5.02 | **â†“58.9%** |
| **æµ‹è¯•å›°æƒ‘åº¦** | 12.46 | 5.06 | **â†“59.4%** |

## ğŸ”§ å‚æ•°è¯´æ˜

### è®­ç»ƒå‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--pop909` | å¿…å¡« | POP909æ•°æ®é›†è·¯å¾„ |
| `--out` | `models/hmm_*.pkl` | è¾“å‡ºæ¨¡å‹æ–‡ä»¶ |
| `--seed` | 42 | éšæœºç§å­ï¼ˆç¡®ä¿å¤ç°æ€§ï¼‰ |
| `--train-ratio` | 0.7 | è®­ç»ƒé›†æ¯”ä¾‹ |
| `--val-ratio` | 0.15 | éªŒè¯é›†æ¯”ä¾‹ |
| `--limit` | None | é™åˆ¶æ­Œæ›²æ•°é‡ï¼ˆè°ƒè¯•ç”¨ï¼‰ |

### Baseline ç‰¹æœ‰å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--no-transpose` | False | ç¦ç”¨è½¬è°ƒåˆ°C/Am |

## ğŸ“ è¾“å‡ºæ–‡ä»¶

### æ¨¡å‹æ–‡ä»¶ç»“æ„

```python
{
    "vocab": dict,           # å’Œå¼¦ â†’ æ•´æ•°æ˜ å°„
    "inv_vocab": dict,       # æ•´æ•° â†’ å’Œå¼¦æ˜ å°„
    "start_prob": np.array,  # åˆå§‹æ¦‚ç‡
    "trans_prob": np.array,  # è½¬ç§»æ¦‚ç‡çŸ©é˜µ
    "metadata": {
        "model_type": str,
        "timestamp": str,
        "vocab_size": int,
        "n_train_songs": int,
        "n_val_songs": int,
        "n_test_songs": int,
        "train_perplexity": float,
        "val_perplexity": float,
        "test_perplexity": float,
        # Conditional ç‰¹æœ‰:
        "n_major_train": int,
        "n_minor_train": int
    }
}
```

### Conditional HMM é¢å¤–å­—æ®µ

```python
{
    "major_start_prob": np.array,
    "major_trans_prob": np.array,
    "minor_start_prob": np.array,
    "minor_trans_prob": np.array
}
```

## ğŸ” è®­ç»ƒæµç¨‹å¯¹æ¯”

### Baseline HMM

```
1. åŠ è½½æ•°æ® â†’ éšæœºåˆ’åˆ† (seed=42)
2. æå–å’Œå¼¦åºåˆ— â†’ è½¬è°ƒè‡³Cå¤§è°ƒ/Aå°è°ƒ
3. æ„å»ºè¯æ±‡è¡¨ (193ä¸ªå’Œå¼¦)
4. è®­ç»ƒå•ä¸€HMM
5. è®¡ç®—å›°æƒ‘åº¦
6. åˆ†æè½¬ç§»æ¨¡å¼
```

### Conditional HMM

```
1. åŠ è½½æ•°æ® â†’ éšæœºåˆ’åˆ† (seed=42)
2. æå–åŠŸèƒ½å’Œå¼¦ â†’ ç½—é©¬æ•°å­—æ ‡è®°
3. æ„å»ºè¯æ±‡è¡¨ (20ä¸ªåŠŸèƒ½å’Œå¼¦)
4. æŒ‰è°ƒå¼åˆ†ç¦» â†’ è®­ç»ƒå¤§è°ƒ/å°è°ƒç‹¬ç«‹HMM
5. è®¡ç®—æ¡ä»¶å›°æƒ‘åº¦
6. åˆ†æè°ƒå¼ç‰¹å®šæ¨¡å¼
```

## ğŸ“ˆ å…³é”®æ”¹è¿›

### å·²ä¿®å¤çš„é—®é¢˜

âœ… **ç»Ÿä¸€æ•°æ®åˆ’åˆ†**: ä¸¤ä¸ªæ¨¡å‹ç°åœ¨ä½¿ç”¨ç›¸åŒçš„éšæœºåˆ’åˆ†ç­–ç•¥  
âœ… **ä¸€è‡´çš„è¾“å‡ºæ ¼å¼**: è®­ç»ƒæ—¥å¿—æ ¼å¼ç»Ÿä¸€  
âœ… **ç§»é™¤ç¡¬ç¼–ç **: Conditionalæ¨¡å‹ä¸å†åŒ…å«å†™æ­»çš„baselineç»“æœ  
âœ… **ç‹¬ç«‹å¯¹æ¯”è„šæœ¬**: ä½¿ç”¨ä¸“é—¨çš„è„šæœ¬è¿›è¡Œæ¨¡å‹å¯¹æ¯”  

### ä»£ç è´¨é‡æå‡

- ğŸ¯ æ¨¡å—åŒ–è®¾è®¡
- ğŸ“Š è¯¦ç»†çš„è®­ç»ƒæ—¥å¿—
- ğŸ”„ å¯å¤ç°çš„å®éªŒï¼ˆå›ºå®šseedï¼‰
- ğŸ“¦ å®Œæ•´çš„å…ƒæ•°æ®ä¿å­˜
- ğŸ§ª ç‹¬ç«‹çš„æµ‹è¯•å’Œå¯¹æ¯”è„šæœ¬

## ğŸ“ æ¨¡å‹è¯´æ˜

### Baseline HMM

**ç‰¹ç‚¹**:
- å°†æ‰€æœ‰æ­Œæ›²è½¬è°ƒåˆ°Cå¤§è°ƒæˆ–Aå°è°ƒ
- ç»Ÿä¸€çš„è½¬ç§»çŸ©é˜µ
- è¯æ±‡é‡: 193ä¸ªå’Œå¼¦ï¼ˆåŒ…æ‹¬å„ç§å’Œå¼¦è´¨é‡ï¼‰

**ä¼˜ç‚¹**:
- ç®€å•ç›´è§‚
- è®¡ç®—é«˜æ•ˆ

**ç¼ºç‚¹**:
- è¯æ±‡é‡å¤§ï¼Œæ•°æ®ç¨€ç–
- æ— æ³•åŒºåˆ†å¤§è°ƒ/å°è°ƒçš„ä¸åŒæ¨¡å¼

### Conditional HMM

**ç‰¹ç‚¹**:
- æå–åŠŸèƒ½å’Œå¼¦ï¼ˆç½—é©¬æ•°å­—ï¼‰
- å¤§è°ƒ/å°è°ƒç‹¬ç«‹è½¬ç§»çŸ©é˜µ
- è¯æ±‡é‡: 20ä¸ªåŠŸèƒ½å’Œå¼¦

**ä¼˜ç‚¹**:
- è¯æ±‡é‡å°ï¼Œæ•°æ®å……åˆ†
- æ•æ‰è°ƒå¼ç‰¹å®šçš„å’Œå£°æ¨¡å¼
- å›°æƒ‘åº¦æ˜¾è‘—é™ä½ï¼ˆ59.4%ï¼‰

**ç¼ºç‚¹**:
- éœ€è¦è°ƒæ€§è¯†åˆ«
- æ¨¡å‹ç¨å¤æ‚ï¼ˆä¸¤ä¸ªçŸ©é˜µï¼‰

## ğŸ”¬ è¯„ä¼°æŒ‡æ ‡

### å›°æƒ‘åº¦ (Perplexity)

$$\text{Perplexity} = \exp\left(-\frac{1}{N}\sum_{i=1}^{N} \log P(x_i)\right)$$

- **è¶Šä½è¶Šå¥½**
- è¡¡é‡æ¨¡å‹çš„ä¸ç¡®å®šæ€§
- Baseline: 12.46 â†’ Conditional: 5.06

### é¢„æµ‹å‡†ç¡®ç‡

- ç»™å®šå‰ä¸€ä¸ªå’Œå¼¦ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªå’Œå¼¦
- ä½¿ç”¨è´ªå©ªç­–ç•¥: `argmax P(next|prev)`
- å¯é€šè¿‡æµ‹è¯•è„šæœ¬è·å¾—

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

**Q: ä¸¤ä¸ªæ¨¡å‹ç»“æœä¸ä¸€è‡´ï¼Ÿ**
A: ç¡®ä¿ä½¿ç”¨ç›¸åŒçš„ `--seed` å‚æ•°

**Q: å†…å­˜ä¸è¶³ï¼Ÿ**
A: ä½¿ç”¨ `--limit 100` é™åˆ¶è®­ç»ƒæ­Œæ›²æ•°é‡

**Q: æ‰¾ä¸åˆ°æ¨¡å‹æ–‡ä»¶ï¼Ÿ**
A: æ£€æŸ¥ `models/` ç›®å½•æ˜¯å¦å­˜åœ¨

## ğŸ“š å¼•ç”¨

å¦‚æœä½¿ç”¨æœ¬ä»£ç ï¼Œè¯·å¼•ç”¨ï¼š

```bibtex
@misc{pop909_hmm,
  title={Hierarchical Bayesian Models for Chord Progression Analysis},
  author={Your Name},
  year={2025}
}
```

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æŸ¥çœ‹ `CODE_VALIDATION_REPORT.md` è·å–è¯¦ç»†çš„ä»£ç éªŒè¯ä¿¡æ¯ã€‚
